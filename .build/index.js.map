{
  "version": 3,
  "sources": ["../index.ts"],
  "sourcesContent": ["const fetch = require('node-fetch');\nconst Database = require(\"@replit/database\");\nconst db = new Database();\nconst express = require('express');\n\nconst re = /var data = \\{.*?\\};/ms;\n\nconst UPDATE_MS = 5 * 60 * 1000;\nconst UPDATES_PER_DAY = 24 * 60 * 60 * 1000 / UPDATE_MS;\nconst MAX_DAYS = 7;\nconst MAX_UPDATES = UPDATES_PER_DAY * MAX_DAYS;\n\nasync function getOccupancy() {\n  const response = await fetch('https://portal.rockgympro.com/portal/public/314b60a77a6eada788f8cd7046931fc5/occupancy');\n  const body = await response.text();\n  const match = body.match(re);\n  if (match) {\n    const data = Function(`${match} return data;`)();\n    return {\n      time: Date.now(),\n      POP: data.POP.count,\n      UPW: data.UPW.count,\n      FRE: data.FRE.count,\n    };\n  }\n}\n\nconst updateInterval = setInterval(async () => {\n  const occupancy = await getOccupancy();\n  let stats = await db.get('stats');\n  if (!stats) {\n    stats = [];\n  }\n  stats.push(occupancy); \n  if (stats.length > MAX_UPDATES) {\n    stats = stats.slice(stats.length - MAX_UPDATES)\n  }\n  await db.set('stats', stats);\n}, UPDATE_MS);\n\nconst app = express();\napp.use(express.static('public'));\napp.get('/stats', async (req, res) => {\n  const stats = await db.get('stats');\n  return res.json(stats);\n});\napp.listen(3000, () => {\n  console.log('listening');\n});"],
  "mappings": "AAAA,MAAM,QAAQ,QAAQ;AACtB,MAAM,WAAW,QAAQ;AACzB,MAAM,KAAK,IAAI;AACf,MAAM,UAAU,QAAQ;AAExB,MAAM,KAAK;AAEX,MAAM,YAAY,IAAI,KAAK;AAC3B,MAAM,kBAAkB,KAAK,KAAK,KAAK,MAAO;AAC9C,MAAM,WAAW;AACjB,MAAM,cAAc,kBAAkB;AAEtC,8BAA8B;AAC5B,QAAM,WAAW,MAAM,MAAM;AAC7B,QAAM,OAAO,MAAM,SAAS;AAC5B,QAAM,QAAQ,KAAK,MAAM;AACzB,MAAI,OAAO;AACT,UAAM,OAAO,SAAS,GAAG;AACzB,WAAO;AAAA,MACL,MAAM,KAAK;AAAA,MACX,KAAK,KAAK,IAAI;AAAA,MACd,KAAK,KAAK,IAAI;AAAA,MACd,KAAK,KAAK,IAAI;AAAA;AAAA;AAAA;AAKpB,MAAM,iBAAiB,YAAY,YAAY;AAC7C,QAAM,YAAY,MAAM;AACxB,MAAI,QAAQ,MAAM,GAAG,IAAI;AACzB,MAAI,CAAC,OAAO;AACV,YAAQ;AAAA;AAEV,QAAM,KAAK;AACX,MAAI,MAAM,SAAS,aAAa;AAC9B,YAAQ,MAAM,MAAM,MAAM,SAAS;AAAA;AAErC,QAAM,GAAG,IAAI,SAAS;AAAA,GACrB;AAEH,MAAM,MAAM;AACZ,IAAI,IAAI,QAAQ,OAAO;AACvB,IAAI,IAAI,UAAU,OAAO,KAAK,QAAQ;AACpC,QAAM,QAAQ,MAAM,GAAG,IAAI;AAC3B,SAAO,IAAI,KAAK;AAAA;AAElB,IAAI,OAAO,KAAM,MAAM;AACrB,UAAQ,IAAI;AAAA;",
  "names": []
}
